---
title: Facebook News Feed System Design Case Study
description: 
published: true
date: 2022-03-26T22:15:40.054Z
tags: front-end, system-design
editor: markdown
---

# Description & Requirements
A news feed is a collection of trending stories on the homepage of a web application. It can include 
- Status updates
- Posts
- Comments
- Likes
- Photos
- Videos
from the user's followees on the application.
## Functional requirements
1. News feed is generated using the posts from other entities in the system that the user followed or the user might be interested in.
2. Posts might have text, image, and video
3. The new posts generated by others should be appended to the news feed of the user.
4. Users can 'like' and comment on posts
5. Users can 'share' the story.
6. Infinite scrollable news feeds whewre stories appear based on user subscriptions. 
7. Support wide range of devices
8. Be accessible to visual and hearing impaired users.

# Component Architecture
## Story Component
### Avatar
### Title (User's name)
### Text and image content
### Control Panel
#### Like Button
#### Comment Button
#### Share Button

## Comments List
Has list of `<Comment />`s 
## Comment
### Avatar
### Text input
### Comment Input

# Data Architecture
## Story
```
type Story = {
	id: number;
  comments: Comment[];
  media: Media[];
  date: number; // timestamp
  content: string;
};
```
Note that `Media` type are things like links, images, videos.
## Comment
```
type Comment = {
id: number;
authorId: number;
media: Media[];
date: number;
content: string;
};
```
## Media 
```
type Media = {
   id: number;
   type: 'link' | 'video' | 'image'
	 uri: string;
};
```

# Data API
## getPosts
```
getPosts(api_key, user_id, dateStart, dateEnd, pageNumber, pageSize)
```
## createPost
```
createPost(api_key, user_id, post_data)
```
## createComment
```
createComment(api_key, user_id, post_id, comment_data);
```

# Data Store Structure
State should be structured based on data types. The actual state within our store should be as normalized/flattened as much as possible. 

The `<Store />` component will get passed a `feed_id`. The `feed_id` will be used to get the story, comments data. 
```
{
feeds: {
	[feed_id]: {...}
},
users: {
	[feed_id]: {...}
},
media: {
	[feed_id]: {...}
},
comments: {
	[feed_id]: {...}
}
}
```

The main takeaway here is that we should be accessing data from the store by keys. We shouldn't have to traverse any arrays or deeply nested objects searching for data required to render our UI.

# Edge Cases
## Loading New Stories
Use **Server Sent Events** over long polling and websockets. Long polling has a lot of overhead since a new request is being sent each time, and websockets doesn't support HTTP2. Server sent events is easy to load balance (why?).
